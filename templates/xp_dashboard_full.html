{% extends "base.html" %}

{% block title %}Dashboard XP - {{ guild_id }}{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard Header */
    .dash-header { display: flex; justify-content: space-between; align-items: center; margin: 30px 0; flex-wrap: wrap; gap: 15px; }
    .dash-title { font-family: 'Orbitron', sans-serif; font-size: 32px; color: #00ccff; text-shadow: 0 0 15px rgba(0,200,255,0.5); }
    .status-badge { padding: 8px 20px; border: 2px solid; font-weight: 700; font-family: 'Orbitron', sans-serif; }
    .status-active { background: rgba(0,255,100,0.1); border-color: #00ff66; color: #00ff66; }
    .status-inactive { background: rgba(255,0,0,0.1); border-color: #ff0000; color: #ff0000; }
    
    /* Tabs */
    .tabs { display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #0066ff; overflow-x: auto; flex-wrap: wrap; }
    .tab { padding: 12px 25px; background: rgba(0,50,100,0.3); border: 2px solid #0066ff; border-bottom: none; color: #66aaff; cursor: pointer; transition: all 0.3s; font-weight: 600; white-space: nowrap; }
    .tab:hover { background: rgba(0,100,200,0.4); color: #00ccff; }
    .tab.active { background: linear-gradient(135deg, #0066ff, #0033ff); color: white; border-color: #00ccff; box-shadow: 0 0 15px rgba(0,150,255,0.5); }
    
    /* Content */
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .config-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-bottom: 30px; }
    
    /* Forms */
    input[type="number"], input[type="text"], input[type="url"], input[type="color"], select, textarea {
        width: 100%; padding: 12px; background: rgba(0,0,0,0.5); border: 2px solid #0066ff; color: #00ccff; font-family: 'Inter', sans-serif;
    }
    textarea { min-height: 120px; resize: vertical; }
    
    /* Toggle Switch */
    .toggle { position: relative; width: 60px; height: 30px; display: inline-block; }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #333; transition: 0.4s; border-radius: 30px; border: 2px solid #0066ff; }
    .toggle-slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 2px; bottom: 2px; background: #0066ff; transition: 0.4s; border-radius: 50%; }
    .toggle input:checked + .toggle-slider { background: #0066ff; }
    .toggle input:checked + .toggle-slider:before { transform: translateX(30px); background: #00ccff; }
    
    /* Buttons */
    .btn-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
    .btn-save { padding: 12px 30px; background: linear-gradient(135deg, #00ff66, #00cc55); border: 2px solid #00ff66; color: #000; font-weight: 700; cursor: pointer; font-family: 'Orbitron', sans-serif; }
    .btn-save:hover { box-shadow: 0 0 20px rgba(0,255,100,0.6); transform: translateY(-2px); }
    .btn-secondary { padding: 12px 30px; background: linear-gradient(135deg, #6688aa, #445566); border: 2px solid #6688aa; color: white; font-weight: 700; cursor: pointer; }
    
    /* Preview */
    .message-preview { background: #2b2d31; border: 2px solid #0066ff; padding: 20px; margin-top: 20px; min-height: 150px; }
    .preview-message { background: #1e1f22; padding: 15px; border-radius: 8px; color: #dcddde; line-height: 1.6; }
    
    /* Placeholder Table */
    .placeholder-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .placeholder-table th, .placeholder-table td { padding: 10px; text-align: left; border: 1px solid #0066ff; }
    .placeholder-table th { background: rgba(0,100,255,0.2); color: #00ccff; font-weight: 700; }
    .placeholder-table td { background: rgba(0,0,0,0.3); color: #66aaff; }
    .placeholder-code { background: rgba(0,100,255,0.2); padding: 2px 8px; border-radius: 3px; font-family: monospace; color: #00ccff; cursor: pointer; }
    .placeholder-code:hover { background: rgba(0,150,255,0.4); }
    
    /* Levels List */
    .levels-list { display: flex; flex-direction: column; gap: 15px; }
    .level-item { background: rgba(0,20,40,0.6); border: 2px solid #0066ff; padding: 20px; display: grid; grid-template-columns: 60px 1fr 1fr 1fr 100px 100px; gap: 15px; align-items: center; }
    .level-number { font-size: 32px; font-weight: 900; color: #00ccff; text-align: center; font-family: 'Orbitron', sans-serif; }
    .level-field { display: flex; flex-direction: column; }
    .level-field label { font-size: 11px; color: #6688aa; margin-bottom: 5px; }
    .level-field input { padding: 8px; background: rgba(0,0,0,0.5); border: 1px solid #0066ff; color: #00ccff; }
    
    /* Stats */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: linear-gradient(135deg, rgba(0,100,255,0.2), rgba(0,50,150,0.1)); border: 2px solid #0066ff; padding: 25px; text-align: center; }
    .stat-value { font-size: 48px; font-weight: 900; color: #00ccff; font-family: 'Orbitron', sans-serif; text-shadow: 0 0 15px rgba(0,200,255,0.5); }
    .stat-label { font-size: 14px; color: #66aaff; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }
    
    /* Responsive */
    @media (max-width: 768px) {
        .tabs { flex-direction: column; }
        .config-grid { grid-template-columns: 1fr; }
        .level-item { grid-template-columns: 1fr; text-align: center; }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="dash-header">
    <h1 class="dash-title">‚öôÔ∏è Dashboard de XP</h1>
    <div class="status-badge {% if config.is_enabled %}status-active{% else %}status-inactive{% endif %}">
        {% if config.is_enabled %}‚úÖ Sistema Ativo{% else %}‚ùå Sistema Desativado{% endif %}
    </div>
</div>

<!-- Tabs -->
<div class="tabs">
    <div class="tab active" data-tab="geral">üè† Geral</div>
    <div class="tab" data-tab="levels">üéØ N√≠veis</div>
    <div class="tab" data-tab="rewards">üéÅ Recompensas</div>
    <div class="tab" data-tab="blocks">üö´ Bloqueios</div>
    <div class="tab" data-tab="messages">üí¨ Mensagens</div>
    <div class="tab" data-tab="rankcard">üé® Rank Card</div>
    <div class="tab" data-tab="stats">üìä Estat√≠sticas</div>
    <div class="tab" data-tab="boosts">üöÄ Boosts</div>
</div>

<!-- TAB 1: GERAL -->
<div class="tab-content active" id="tab-geral">
    <div class="config-grid">
        <div class="card">
            <h3 class="card-title">‚ö° Ativar Sistema de XP</h3>
            <label class="toggle">
                <input type="checkbox" id="is_enabled" {% if config.is_enabled %}checked{% endif %}>
                <span class="toggle-slider"></span>
            </label>
            <p style="color: #6688aa; margin-top: 10px;">Quando desativado, nenhum usu√°rio ganhar√° XP</p>
        </div>
        
        <div class="card">
            <h3 class="card-title">üíé XP por Mensagem</h3>
            <div class="form-group">
                <label>M√≠nimo:</label>
                <input type="number" id="min_xp" value="{{ config.min_xp }}" min="1" max="100">
            </div>
            <div class="form-group">
                <label>M√°ximo:</label>
                <input type="number" id="max_xp" value="{{ config.max_xp }}" min="1" max="100">
            </div>
        </div>
        
        <div class="card">
            <h3 class="card-title">‚è±Ô∏è Cooldown</h3>
            <div class="form-group">
                <label>Segundos entre mensagens:</label>
                <input type="number" id="cooldown" value="{{ config.cooldown }}" min="0" max="300">
            </div>
            <p style="color: #6688aa; font-size: 13px;">Tempo m√≠nimo entre mensagens para ganhar XP</p>
        </div>
        
        <div class="card">
            <h3 class="card-title">üìã Canal de Log</h3>
            <div class="form-group">
                <label>ID do Canal:</label>
                <input type="text" id="log_channel" value="{{ config.log_channel if config.log_channel else '' }}" placeholder="Ex: 123456789">
            </div>
            <p style="color: #6688aa; font-size: 13px;">Canal para logs de eventos (opcional)</p>
        </div>
    </div>
    
    <div class="btn-group">
        <button class="btn btn-save" onclick="saveGeneralConfig()">üíæ Salvar Configura√ß√µes</button>
        <button class="btn btn-danger" onclick="resetAllXP()">üóëÔ∏è Zerar XP de Todos</button>
    </div>
</div>

<!-- TAB 2: N√çVEIS -->
<div class="tab-content" id="tab-levels">
    <div class="card">
        <h3 class="card-title">üéØ N√≠veis e Cargos</h3>
        <p style="color: #6688aa; margin-bottom: 20px;">Configure os n√≠veis, XP necess√°rio e multiplicadores</p>
        
        <div class="levels-list" id="levels-list">
            {% for level in levels %}
            <div class="level-item">
                <div class="level-number">{{ level.level }}</div>
                
                <div class="level-field">
                    <label>Nome do Cargo</label>
                    <input type="text" value="{{ level.role_name }}" data-level-id="{{ level.id }}" data-field="role_name">
                </div>
                
                <div class="level-field">
                    <label>ID do Cargo</label>
                    <input type="text" value="{{ level.role_id }}" data-level-id="{{ level.id }}" data-field="role_id">
                </div>
                
                <div class="level-field">
                    <label>XP Necess√°rio</label>
                    <input type="number" value="{{ level.required_xp }}" data-level-id="{{ level.id }}" data-field="required_xp">
                </div>
                
                <div class="level-field">
                    <label>Multiplicador</label>
                    <input type="number" step="0.1" value="{{ level.multiplier }}" data-level-id="{{ level.id }}" data-field="multiplier">
                </div>
                
                <button class="btn btn-danger" onclick="deleteLevel({{ level.id }})">üóëÔ∏è</button>
            </div>
            {% endfor %}
        </div>
        
        <div class="btn-group">
            <button class="btn btn-save" onclick="saveLevels()">üíæ Salvar N√≠veis</button>
            <button class="btn btn-secondary" onclick="addLevel()">‚ûï Adicionar N√≠vel</button>
        </div>
    </div>
</div>

<!-- TAB 3: RECOMPENSAS -->
<div class="tab-content" id="tab-rewards">
    <div class="config-grid">
        <div class="card">
            <h3 class="card-title">üéÅ Modo de Recompensa</h3>
            <div class="form-group">
                <label>
                    <input type="radio" name="reward_mode" value="stack" {% if config.reward_mode == 'stack' %}checked{% endif %}>
                    üìö Empilhar cargos (mant√©m todos os anteriores)
                </label>
            </div>
            <div class="form-group">
                <label>
                    <input type="radio" name="reward_mode" value="replace" {% if config.reward_mode == 'replace' %}checked{% endif %}>
                    üîÑ Substituir cargo (remove o anterior)
                </label>
            </div>
        </div>
        
        <div class="card">
            <h3 class="card-title">üí∞ B√¥nus ao Subir de N√≠vel</h3>
            <div class="form-group">
                <label>XP Extra:</label>
                <input type="number" id="bonus_on_levelup" value="{{ config.bonus_on_levelup }}" min="0">
            </div>
            <p style="color: #6688aa; font-size: 13px;">XP adicional ao alcan√ßar um novo n√≠vel</p>
        </div>
    </div>
    
    <div class="btn-group">
        <button class="btn btn-save" onclick="saveRewards()">üíæ Salvar Recompensas</button>
    </div>
</div>

<!-- TAB 4: BLOQUEIOS -->
<div class="tab-content" id="tab-blocks">
    <div class="card">
        <h3 class="card-title">üö´ Cargos e Canais Bloqueados</h3>
        <p style="color: #6688aa; margin-bottom: 20px;">Usu√°rios com estes cargos ou mensagens nestes canais N√ÉO ganhar√£o XP</p>
        
        <div class="form-group">
            <label>üé≠ IDs dos Cargos Bloqueados (separados por v√≠rgula):</label>
            <textarea id="blocked_roles" placeholder="Ex: 123456789, 987654321">{{ config.blocked_roles if config.blocked_roles else '' }}</textarea>
        </div>
        
        <div class="form-group">
            <label>üì¢ IDs dos Canais Bloqueados (separados por v√≠rgula):</label>
            <textarea id="blocked_channels" placeholder="Ex: 123456789, 987654321">{{ config.blocked_channels if config.blocked_channels else '' }}</textarea>
        </div>
        
        <div class="btn-group">
            <button class="btn btn-save" onclick="saveBlocks()">üíæ Salvar Bloqueios</button>
        </div>
    </div>
</div>

<!-- TAB 5: MENSAGENS -->
<div class="tab-content" id="tab-messages">
    <div class="config-grid">
        <div class="card">
            <h3 class="card-title">üí¨ Onde Anunciar Level Up</h3>
            <div class="form-group">
                <label><input type="radio" name="announce_mode" value="none" {% if config.announce_mode == 'none' %}checked{% endif %}> üö´ Nenhum</label>
            </div>
            <div class="form-group">
                <label><input type="radio" name="announce_mode" value="current" {% if config.announce_mode == 'current' %}checked{% endif %}> üí¨ Canal atual</label>
            </div>
            <div class="form-group">
                <label><input type="radio" name="announce_mode" value="dm" {% if config.announce_mode == 'dm' %}checked{% endif %}> üìß Mensagem direta (DM)</label>
            </div>
            <div class="form-group">
                <label><input type="radio" name="announce_mode" value="custom" {% if config.announce_mode == 'custom' %}checked{% endif %}> üìç Canal personalizado</label>
            </div>
            
            <div class="form-group" id="custom-channel-group" style="{% if config.announce_mode != 'custom' %}display: none;{% endif %}">
                <label>ID do Canal:</label>
                <input type="text" id="announce_channel" value="{{ config.announce_channel if config.announce_channel else '' }}" placeholder="Ex: 123456789">
            </div>
        </div>
        
        <div class="card">
            <h3 class="card-title">üé® Tipo de Mensagem</h3>
            <div class="form-group">
                <label><input type="radio" name="announce_type" value="text" {% if config.announce_type == 'text' %}checked{% endif %}> üìù Texto simples</label>
            </div>
            <div class="form-group">
                <label><input type="radio" name="announce_type" value="embed" {% if config.announce_type == 'embed' %}checked{% endif %}> üìã Embed</label>
            </div>
            <div class="form-group">
                <label><input type="radio" name="announce_type" value="image" {% if config.announce_type == 'image' %}checked{% endif %}> üñºÔ∏è Imagem (Rank Card)</label>
            </div>
        </div>
    </div>
    
    <div class="card">
        <h3 class="card-title">‚úèÔ∏è Mensagem Personalizada</h3>
        <div class="form-group">
            <label>Mensagem:</label>
            <textarea id="message_template" rows="4">{{ config.message_template }}</textarea>
        </div>
        
        <div class="message-preview">
            <div class="preview-title">üëÅÔ∏è Preview:</div>
            <div class="preview-message" id="message-preview"></div>
        </div>
        
        <h4 style="color: #00ccff; margin: 20px 0 10px 0;">üìå Placeholders Dispon√≠veis:</h4>
        <table class="placeholder-table">
            <thead>
                <tr>
                    <th>Placeholder</th>
                    <th>Descri√ß√£o</th>
                    <th>Exemplo</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="placeholder-code" onclick="insertPlaceholder('{user}')">{user}</span></td>
                    <td>Nome do usu√°rio</td>
                    <td>Jo√£o</td>
                </tr>
                <tr>
                    <td><span class="placeholder-code" onclick="insertPlaceholder('{user_mention}')">{user_mention}</span></td>
                    <td>Men√ß√£o ao usu√°rio</td>
                    <td>@Jo√£o</td>
                </tr>
                <tr>
                    <td><span class="placeholder-code" onclick="insertPlaceholder('{level}')">{level}</span></td>
                    <td>N√≠vel alcan√ßado</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td><span class="placeholder-code" onclick="insertPlaceholder('{level_name}')">{level_name}</span></td>
                    <td>Nome do cargo do n√≠vel</td>
                    <td>√©pico</td>
                </tr>
                <tr>
                    <td><span class="placeholder-code" onclick="insertPlaceholder('{xp}')">{xp}</span></td>
                    <td>XP total do usu√°rio</td>
                    <td>2,500</td>
                </tr>
                <tr>
                    <td><span class="placeholder-code" onclick="insertPlaceholder('{next_level_xp}')">{next_level_xp}</span></td>
                    <td>XP necess√°rio para pr√≥ximo n√≠vel</td>
                    <td>4,000</td>
                </tr>
                <tr>
                    <td><span class="placeholder-code" onclick="insertPlaceholder('{guild_name}')">{guild_name}</span></td>
                    <td>Nome do servidor</td>
                    <td>Meu Servidor</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="btn-group">
        <button class="btn btn-save" onclick="saveMessages()">üíæ Salvar Mensagens</button>
    </div>
</div>

<!-- TAB 6: RANK CARD -->
<div class="tab-content" id="tab-rankcard">
    <div class="config-grid">
        <div class="card">
            <h3 class="card-title">üé® Cor de Fundo</h3>
            <div class="form-group">
                <label>Cor:</label>
                <input type="color" id="image_bg_color" value="{{ config.image_bg_color }}">
            </div>
        </div>
        
        <div class="card">
            <h3 class="card-title">üñºÔ∏è Imagem de Fundo (URL)</h3>
            <div class="form-group">
                <label>URL:</label>
                <input type="url" id="image_bg_url" value="{{ config.image_bg_url if config.image_bg_url else '' }}" placeholder="https://...">
            </div>
            <p style="color: #6688aa; font-size: 13px;">Deixe vazio para usar cor s√≥lida</p>
        </div>
        
        <div class="card">
            <h3 class="card-title">üìä Cor da Barra de Progresso</h3>
            <div class="form-group">
                <label>Cor:</label>
                <input type="color" id="image_bar_color" value="{{ config.image_bar_color }}">
            </div>
        </div>
        
        <div class="card">
            <h3 class="card-title">‚úèÔ∏è Cor do Texto</h3>
            <div class="form-group">
                <label>Cor:</label>
                <input type="color" id="image_text_color" value="{{ config.image_text_color }}">
            </div>
        </div>
    </div>
    
    <div class="btn-group">
        <button class="btn btn-save" onclick="saveRankCard()">üíæ Salvar Rank Card</button>
        <button class="btn btn-secondary" onclick="previewRankCard()">üëÅÔ∏è Preview</button>
    </div>
</div>

<!-- TAB 7: ESTAT√çSTICAS -->
<div class="tab-content" id="tab-stats">
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ total_users }}</div>
            <div class="stat-label">üë• Usu√°rios com XP</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" id="total-xp">-</div>
            <div class="stat-label">üíé XP Total do Servidor</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" id="avg-xp">-</div>
            <div class="stat-label">üìä M√©dia de XP</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value" id="total-messages">-</div>
            <div class="stat-label">üí¨ Total de Mensagens</div>
        </div>
    </div>
    
    <div class="card">
        <h3 class="card-title">üìú Logs Recentes</h3>
        <div id="recent-logs" style="max-height: 400px; overflow-y: auto;">
            <p style="color: #6688aa; text-align: center; padding: 20px;">Carregando logs...</p>
        </div>
    </div>
    
    <div class="btn-group">
        <button class="btn btn-secondary" onclick="exportCSV()">üì• Exportar CSV</button>
    </div>
</div>

<!-- TAB 8: BOOSTS -->
<div class="tab-content" id="tab-boosts">
    {% if boost %}
    <div class="card" style="background: linear-gradient(135deg, rgba(255,200,0,0.2), rgba(255,150,0,0.1)); border-color: #ffcc00;">
        <h3 class="card-title" style="color: #ffcc00;">üöÄ Boost Ativo</h3>
        <p style="font-size: 24px; color: #ffcc00; font-weight: 700;">{{ boost.multiplier }}x XP</p>
        <p style="color: #6688aa;">Expira em: <span id="boost-expire"></span></p>
    </div>
    <script>
        const boostExpire = new Date('{{ boost.expires_at }}');
        document.getElementById('boost-expire').textContent = boostExpire.toLocaleString('pt-BR');
    </script>
    {% else %}
    <div class="card">
        <h3 class="card-title">üöÄ Criar Boost Tempor√°rio</h3>
        <p style="color: #6688aa; margin-bottom: 20px;">Nenhum boost ativo no momento</p>
        
        <div class="btn-group">
            <button class="btn btn-save" onclick="createBoost()">üöÄ Criar Boost</button>
        </div>
    </div>
    {% endif %}
</div>

<script src="/static/js/xp_dashboard.js"></script>
{% endblock %}
