<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CAOS Hub</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <h1>üî• CAOS HUB</h1>
            <div class="nav-user">
                <img src="https://cdn.discordapp.com/avatars/{{ user.id }}/{{ user.avatar }}.png" alt="Avatar" class="avatar-small">
                <span>{{ user.username }}</span>
                <a href="{{ url_for('logout') }}" class="btn btn-small">Sair</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="sidebar">
            <h3>üìã Menu</h3>
            <ul>
                <li><a href="{{ url_for('dashboard') }}" class="active">üìä Painel Geral</a></li>
                <li><a href="{{ url_for('tickets_page') }}">üé´ Tickets</a></li>
            </ul>
        </div>

        <div class="main-content">
            <div class="header-section">
                <h2>üìä Painel de Controle</h2>
                <p>Gerencie todos os sistemas do servidor</p>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Sistema de Boas-vindas -->
            <div class="card">
                <div class="card-header">
                    <h3>üëã Sistema de Boas-vindas</h3>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-welcome" {% if welcome_config.welcome_enabled %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="label">Status:</span>
                        <span class="status {% if welcome_config.welcome_enabled %}status-online{% else %}status-offline{% endif %}" id="welcome-status">
                            {% if welcome_config.welcome_enabled %}‚úÖ Online{% else %}‚ùå Offline{% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">Canal:</span>
                        <span class="value">#{{ welcome_channel.name if welcome_channel else 'N√£o configurado' }}</span>
                    </div>
                </div>
            </div>

            <!-- Sistema de Sa√≠da/Ban -->
            <div class="card">
                <div class="card-header">
                    <h3>üëã Sistema de Sa√≠da/Ban</h3>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-goodbye" {% if welcome_config.goodbye_enabled %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="label">Status:</span>
                        <span class="status {% if welcome_config.goodbye_enabled %}status-online{% else %}status-offline{% endif %}" id="goodbye-status">
                            {% if welcome_config.goodbye_enabled %}‚úÖ Online{% else %}‚ùå Offline{% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">Canal:</span>
                        <span class="value">#{{ goodbye_channel.name if goodbye_channel else 'N√£o configurado' }}</span>
                    </div>
                </div>
            </div>

            <!-- Sistema de Autorole -->
            <div class="card">
                <div class="card-header">
                    <h3>üé≠ Sistema de Autorole</h3>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-autorole" {% if welcome_config.autorole_enabled %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="label">Status:</span>
                        <span class="status {% if welcome_config.autorole_enabled %}status-online{% else %}status-offline{% endif %}" id="autorole-status">
                            {% if welcome_config.autorole_enabled %}‚úÖ Online{% else %}‚ùå Offline{% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">Cargo:</span>
                        <span class="value">@{{ autorole.name if autorole else 'N√£o configurado' }}</span>
                    </div>
                </div>
            </div>

            <!-- Sistema de Tickets -->
            <div class="card">
                <div class="card-header">
                    <h3>üé´ Sistema de Tickets</h3>
                    <label class="toggle">
                        <input type="checkbox" id="toggle-tickets" {% if welcome_config.tickets_enabled %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="label">Status:</span>
                        <span class="status {% if welcome_config.tickets_enabled %}status-online{% else %}status-offline{% endif %}" id="tickets-status">
                            {% if welcome_config.tickets_enabled %}‚úÖ Online{% else %}‚ùå Offline{% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">Categoria:</span>
                        <span class="value">{{ ticket_category.name if ticket_category else 'N√£o configurado' }}</span>
                    </div>
                    {% if ticket_staff_roles %}
                    <div class="info-row">
                        <span class="label">Staff:</span>
                        <span class="value">
                            {% for role in ticket_staff_roles[:3] %}
                                @{{ role.name }}{% if not loop.last %}, {% endif %}
                            {% endfor %}
                            {% if ticket_staff_roles|length > 3 %}
                                e mais {{ ticket_staff_roles|length - 3 }}...
                            {% endif %}
                        </span>
                    </div>
                    {% endif %}
                    <div class="card-actions">
                        <a href="{{ url_for('tickets_page') }}" class="btn btn-primary">‚öôÔ∏è Configurar Tickets</a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Fun√ß√£o para toggle de sistemas
        async function toggleSystem(system, checkbox, statusElement) {
            try {
                const response = await fetch(`/api/toggle/${system}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    // Atualizar status visual
                    if (data.enabled) {
                        statusElement.textContent = '‚úÖ Online';
                        statusElement.className = 'status status-online';
                    } else {
                        statusElement.textContent = '‚ùå Offline';
                        statusElement.className = 'status status-offline';
                    }

                    // Mostrar mensagem
                    showNotification(data.message, 'success');
                } else {
                    // Reverter checkbox se falhou
                    checkbox.checked = !checkbox.checked;
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                // Reverter checkbox se erro
                checkbox.checked = !checkbox.checked;
                showNotification('‚ùå Erro ao atualizar sistema', 'error');
                console.error('Erro:', error);
            }
        }

        // Fun√ß√£o para mostrar notifica√ß√µes
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} notification-popup`;
            notification.textContent = message;
            document.body.appendChild(notification);

            // Remover ap√≥s 3 segundos
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Event listeners para os toggles
        document.getElementById('toggle-welcome').addEventListener('change', function() {
            toggleSystem('welcome', this, document.getElementById('welcome-status'));
        });

        document.getElementById('toggle-goodbye').addEventListener('change', function() {
            toggleSystem('goodbye', this, document.getElementById('goodbye-status'));
        });

        document.getElementById('toggle-autorole').addEventListener('change', function() {
            toggleSystem('autorole', this, document.getElementById('autorole-status'));
        });

        document.getElementById('toggle-tickets').addEventListener('change', function() {
            toggleSystem('tickets', this, document.getElementById('tickets-status'));
        });
    </script>
</body>
</html>
